(function(){function z(a,d){var c=arguments.length,b=c==1?a:d,g,e={};i.isArr(b)?(c=b.length,g=function(a){for(var e=0;e<c;e++)if(p(a,b[e])>-1)return!0;return!1}):g=function(a){return p(a,b)>-1};return c==2?(e={},e[a]=g,e):g}function v(a){return a.length?n.call(a):q(a)}function A(){var a=n.call(arguments),d,c,b,g,e,f,j,l={},k=v(i.isArr(this)?this:a.shift());a.length==2&&i.isStr(a[0])&&(b={},b[a[0]]=a[1],a=[o({},b)]);for(c=0;c<a.length;c++)if(d=a[c],i.isFun(d)){d=d.single;l={};for(e=k.length,j=e-1;j>=
0;j--){b=k[j];if(b in l){if(!l[b])continue}else if(!(l[b]=d(b)))continue;e-(j+1)&&(f=j+1,k.splice(f,e-f));e=j}f=j+1;e-f&&k.splice(f,e-f)}else m(d,function(a,c){if(i.isFun(c)){l={};for(e=k.length,j=e-1;j>=0;j--)b=k[j],a in b&&(g=b[a],c(g,b)&&(e-(j+1)&&(f=j+1,k.splice(f,e-f)),e=j))}else for(e=k.length,j=e-1;j>=0;j--)b=k[j],a in b&&b[a]===c&&(e-(j+1)&&(f=j+1,k.splice(f,e-f)),e=j);f=j+1;e-f&&k.splice(f,e-f)});return k}function B(a,d){var c,b=arguments.length,g,e={};b==1?g=a:b==2&&(g=d);g=g.toString().toLowerCase();
c=function(a){return a.toString().toLowerCase().search(g)>-1};return b==2?(e={},e[a]=c,e):c}function w(a){var d={x:a};return function(a,b){arguments.length==2&&(d[a]=b);return d[a]}}function r(a){var d={};m(a,function(a){d[a]=!0});return d}function q(a){var d=[],c;for(c in a)d.push(a[c]);return d}function o(a,d){for(var c,b,g,e,f=arguments.length,j=0;j<f;j++){c=arguments[j];for(var l in c)b=a[l],g=c[l],a!==g&&(g&&(g.constructor==Object||(e=i.isArr(g)))?(e?(e=!1,b=b&&i.isArr(constructor)?b:[]):b=b&&
b.constructor==Object?b:{},a[l]=o(b,g)):g!==void 0&&(a[l]=g))}return a}function C(a,d){var c=[],b;arguments.length==2?(b=a,a=d):b=this;if(i.isArr(b))c=x(b,a);else{var c={},g;for(g in b)i.isFun(b[g])||(c[g]=a.call(this,b[g]))}return c}var n=Array.prototype.slice,s=Object.prototype.toString,t={},y={},i={isFun:function(a){return!(!a||!a.constructor||!a.call||!a.apply)},isStr:function(a){return!!(a===""||a&&a.charCodeAt&&a.substr)},isNum:function(a){return s.call(a)==="[object Number]"},isArr:[].isArray||
function(a){return s.call(a)==="[object Array]"},isObj:function(a){return a==null?String(a)=="object":s.call(a)==="[object Object]"||!0}},p=[].indexOf?function(a,d){return a.indexOf(d)}:function(a,d){for(var c=a.length-1;c!=-1&&d!=a[c];c--);return c},D={}.keys||function(a){var d=[],c;for(c in a)d.push(c);return d},x=[].map?function(a,d){return a.map(d)}:function(a,d){for(var c=[],b=0,g=obj.length;b<g;b++)c.push(d(obj[b],b));return c},m=[].forEach?function(a,d){if(i.isArr(a))a.forEach(d);else for(var c in a)d(c,
a[c])}:function(a,d){if(i.isArr(a))for(var c=0,b=a.length;c<b;c++)d(a[c],c);else for(c in a)d(c,a[c])};m("< <= > >= == === != !==".split(" "),function(a){y[a]=Function("rhs","return function(x){return x"+a+"rhs}")});var E=function(){var a={};return function(d,c){var b,g=arguments.length,e=g==1?d:c||[],f={};e.length?e.length<20&&i.isNum(e[0])?(b=e.join(","),b=a[b]?a[b]:a[b]=new Function("x","return x=="+e.join("||x=="))):b=function(a){return p(e,a)>-1}:b=i.isFun(e)?function(a){return p(e(),a)>-1}:
e;return g==2?(f={},f[d]=b,f):b}}(),F=function(){var a=/^\s*([=<>!]+)['"]*(.*)$/,d,c={};return function(){return function(b,g){var e,f;if(i.isStr(b)){f=b;if(arguments.length==1)if(c[f])e=c[f];else{try{e=new Function("x,rec","return x "+f)}catch(j){e={}}try{e.single=new Function("rec","return "+b)}catch(l){}c[f]=e}arguments.length==2&&i.isStr(g)&&(e={},f=g,c[f]||(c[f]=(d=f.match(a))!==null?y[d[1]](d[2].replace(/['"]$/,"")):new Function("x,rec","return x "+f)),e[b]=c[f]);return e}}}}();(function(){var a=
{},d=(Math.random()*Math.pow(2,32)).toString(36),c=1,b;a.stain=function(a){c++;b=d+c;for(var e=0,f=a.length;e<f;e++)a[e][b]=!0;return b};a.isStained=function(a){var c=a[b];c&&delete a[b];return c};return a})();var u=function(){var a={},d=0;a.stain=function(a){d++;for(var b=0,g=a.length;b<g;b++)a[b].constructor("i",d);return d};a.isStained=function(a){return a.constructor("i")==d};return a}();stainer=u;var G=r("has isin group remove update where select find order each like".split(" "));self.DB=function(a,
d){function c(a){return a}function b(){for(var a=0,b=j.length;a<b;a++)j[a].call(h,k)}function g(a){for(var b in G)a[b]=h[b];return a}function e(a){for(var b=[],c=0,e=a.length;c<e;c++)b[c]=k[a[c]];return b}var f={},j=[],l=!1,k=[];k._indexCache={};var h=F();h.isin=E;h.has=z;h.like=B;h.each=h.map=C;h.template={create:function(a){l=a},update:function(a){o(l||{},a)},get:function(){return l},destroy:function(){l=!1}};h.group=function(a){var b={};filter=i.isArr(this)?this:h.find();m(filter,function(c){b[c[a]]||
(b[c[a]]=[]);b[c[a]].push(c)});return g(b)};h.sync=function(a){j.push(a)};h.order=h.sort=function(a,b){var c,e=arguments.length,d;i.isFun(a)?c=a:i.isStr(a)&&(e==1?d="x-y":e==2&&(i.isStr(b)&&(b.toLowerCase()=="asc"?d="x-y":b.toLowerCase()=="desc"&&(d="y-x")),typeof d=="undefined"&&(d=b)),i.isStr(d)&&(d=t[d]?t[d]:t[d]=new Function("x,y","return "+d)),c=function(b,c){return d(b[a],c[a])});return(i.isArr(this)?this:h.find()).sort(c)};h.constrain=function(){var a=o,b=f,c;var d=arguments,e={};d.length==
2?(e[d[0]]=d[1],c=e):d.length==1&&(c=d[0]);f=a(b,c)};h.inverse=function(a){arguments.length==0&&i.isArr(this)&&(a=this);var b;b=k;var c=a;b=r(b);var c=r(c),d;for(d in c)b[d]&&delete b[d];b=D(b);return g(b)};h.where=h.find=function(){return g(A.apply(this,arguments.length?[k].concat(n.call(arguments)):[k]))};h.findFirst=function(){var a=h.find.apply(this,n.call(arguments));return a.length?a[0]:{}};h.select=function(a){var b,c={};arguments.length>1?a=n.call(arguments):i.isStr(a)&&(a=[a]);b=i.isArr(this)?
this:h.find();m(a,function(a,d){if(a=="*")c=x(b,q);else for(var e=0,g=b.length;e<g;e++)row=b[e],a in row&&(g>1?(c[e]||(c[e]=[]),c[e][d]=row[a]):c[e]=row[a])});return g(q(c))};h.insert=function(a){var d={},h=[],j=[];arguments.length>1?h=n.call(arguments):i.isArr(a)?h=a:h.push(a);f.unique&&m(k,function(a,b){d[a[f.unique]]=b});m(h,function(a){if(f.unique&&a[f.unique]in d)j.push(d[a[f.unique]]);else{var b=k.length,c;if(l){var e={};m(l,function(a,b){e[a]=i.isFun(b)?b():b});a=o(e,a)}try{c=new (w(b)),o(c,
a),k.push(c)}catch(g){if(!unsafe)a.constructor=w(b);k.push(a)}j.push(b)}});b();return g(c(e(j)))};h.update=function(a,c){var d,e;d=i.isArr(this)?v(this):h.find();arguments.length==2&&i.isStr(a)&&(e=a,a={},a[e]=c);i.isFun(a)?m(d,a):m(a,function(a,b){i.isFun(b)?m(d,function(c){c[a]=b(c)}):m(d,function(c){c[a]=b})});b();return g(d)};h.remove=function(a){var c,d,e=[];c=i.isArr(this)?this:i.isArr(a)?a:arguments.length>0?h.find(a):h.find();u.stain(c);c=k.length;for(var f=k.length-1;f>=0;f--)u.isStained(k[f])?
e.push(k[f]):(c-(f+1)&&(d=f+1,k.splice(d,c-d)),c=f);d=f+1;c-d&&k.splice(d,c-d);b();return g(e)};if(arguments.length==1)if(i.isArr(a))h.insert(a);else if(i.isFun(a))h.insert(a());else if(i.isStr(a))return h.apply(this,arguments);else i.isObj(a)&&h.insert(a);else arguments.length>1&&h.insert(n.call(arguments));h.__raw__=k;return h}})();
