(function(){function y(a){var d={};m(a,function(a){d[a]=!0});return d}function z(a,d){var c=arguments.length,b=c==1?a:d,f,e={};i.isArr(b)?(c=b.length,f=function(a){for(var d=0;d<c;d++)if(p(a,b[d])>-1)return!0;return!1}):f=function(a){return p(a,b)>-1};return c==2?(e={},e[a]=f,e):f}function A(a){return a.length?n.call(a):q(a)}function B(){var a=n.call(arguments),d,c,b,f,e,g,j,k=A(i.isArr(this)?this:a.shift());a.length==2&&i.isStr(a[0])&&(b={},b[a[0]]=a[1],a=[o({},b)]);for(c=0;c<a.length;c++)if(d=a[c],
i.isFun(d)){d=d.single||d;for(e=k.length,j=e-1;j>=0;j--)b=k[j],d(b)&&(e-(j+1)&&(g=j+1,k.splice(g,e-g)),e=j);g=j+1;e-g&&k.splice(g,e-g)}else m(d,function(a,c){if(i.isFun(c))for(e=k.length,j=e-1;j>=0;j--)b=k[j],a in b&&(f=b[a],c(f,b)&&(e-(j+1)&&(g=j+1,k.splice(g,e-g)),e=j));else for(e=k.length,j=e-1;j>=0;j--)b=k[j],a in b&&b[a]===c&&(e-(j+1)&&(g=j+1,k.splice(g,e-g)),e=j);g=j+1;e-g&&k.splice(g,e-g)});return k}function C(){var a=y(n.call(arguments));return function(d){for(var c in a)if(c in d)return!1;
return!0}}function D(a,d){var c,b=arguments.length,f,e={};b==1?f=a:b==2&&(f=d);f=f.toString().toLowerCase();c=function(a){return a.toString().toLowerCase().search(f)>-1};return b==2?(e={},e[a]=c,e):c}function v(a){var d={x:a};return function(a,b){arguments.length==2&&(d[a]=b);return d[a]}}function r(a){var d={};m(a,function(a){d[a]=!0});return d}function q(a){var d=[],c;for(c in a)d.push(a[c]);return d}function o(a,d){for(var c,b,f,e,g=arguments.length,j=0;j<g;j++){c=arguments[j];for(var k in c)b=
a[k],f=c[k],a!==f&&(f&&(f.constructor==Object||(e=i.isArr(f)))?(e?(e=!1,b=b&&i.isArr(constructor)?b:[]):b=b&&b.constructor==Object?b:{},a[k]=o(b,f)):f!==void 0&&(a[k]=f))}return a}function E(a,d){var c=[],b;arguments.length==2?(b=a,a=d):b=this;if(i.isArr(b))c=w(b,a);else{var c={},f;for(f in b)i.isFun(b[f])||(c[f]=a.call(this,b[f]))}return c}var n=Array.prototype.slice,s=Object.prototype.toString,t={},x={},i={isFun:function(a){return!(!a||!a.constructor||!a.call||!a.apply)},isStr:function(a){return!!(a===
""||a&&a.charCodeAt&&a.substr)},isNum:function(a){return s.call(a)==="[object Number]"},isArr:[].isArray||function(a){return s.call(a)==="[object Array]"},isObj:function(a){return a==null?String(a)=="object":s.call(a)==="[object Object]"||!0}},p=[].indexOf?function(a,d){return a.indexOf(d)}:function(a,d){for(var c=a.length-1;c!=-1&&d!=a[c];c--);return c},F={}.keys||function(a){var d=[],c;for(c in a)d.push(c);return d},w=[].map?function(a,d){return a.map(d)}:function(a,d){for(var c=[],b=0,f=obj.length;b<
f;b++)c.push(d(obj[b],b));return c},m=[].forEach?function(a,d){if(i.isArr(a))a.forEach(d);else for(var c in a)d(c,a[c])}:function(a,d){if(i.isArr(a))for(var c=0,b=a.length;c<b;c++)d(a[c],c);else for(c in a)d(c,a[c])};m("< <= > >= == === != !==".split(" "),function(a){x[a]=Function("rhs","return function(x){return x"+a+"rhs}")});var G=function(){var a={};return function(d,c){var b,f=arguments.length,e=f==1?d:c||[],g={};e.length?e.length<20&&i.isNum(e[0])?(b=e.join(","),b=a[b]?a[b]:a[b]=new Function("x",
"return x=="+e.join("||x=="))):b=function(a){return p(e,a)>-1}:b=i.isFun(e)?function(a){return p(e(),a)>-1}:e;return f==2?(g={},g[d]=b,g):b}}(),H=function(){var a=/^\s*([=<>!]+)['"]*(.*)$/,d,c={};return function(){return function(b,f){var e,g;if(i.isStr(b)){g=b;if(arguments.length==1)if(c[g])e=c[g];else{try{e=new Function("x,rec","return x "+g)}catch(j){e={}}try{e.single=new Function("rec","return "+b)}catch(k){}c[g]=e}arguments.length==2&&i.isStr(f)&&(e={},g=f,c[g]||(c[g]=(d=g.match(a))!==null?x[d[1]](d[2].replace(/['"]$/,
"")):new Function("x,rec","return x "+g)),e[b]=c[g]);return e}}}}(),u=function(){var a={},d=0;a.stain=function(a){d++;for(var b=0,f=a.length;b<f;b++)a[b].constructor("i",d);return d};a.isStained=function(a){return a.constructor("i")==d};return a}();stainer=u;var I=r("has missing isin group remove update where select find sort order each like".split(" "));self.DB=function(a,d){function c(){if(!j){j=!0;for(var a=0,b=g.length;a<b;a++)g[a].call(h,l);j=!1}}function b(a){for(var b in I)a[b]=h[b];return a}
function f(a){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=l[a[c]];return b}var e={},g=[],j=!1,k=!1,l=[],h=H();h.isin=G;h.has=z;h.like=D;h.each=h.map=E;h.template={create:function(a){k=a},update:function(a){o(k||{},a)},get:function(){return k},destroy:function(){k=!1}};h.group=function(a){var c={},d=i.isArr(this)?this:h.find();m(d,function(b){c[b[a]]||(c[b[a]]=[]);c[b[a]].push(b)});return b(c)};h.sync=function(a){g.push(a)};h.order=h.sort=function(a,b){var c,d=arguments.length,e,f=i.isArr(this)?this:
h.find();i.isFun(a)?c=a:i.isStr(a)&&(d==1?e="x-y":d==2&&(i.isStr(b)&&(b.toLowerCase()=="asc"?e="x-y":b.toLowerCase()=="desc"&&(e="y-x")),typeof e=="undefined"&&(e=b)),i.isStr(e)&&(e=t[e]?t[e]:t[e]=new Function("x,y","return "+e)),c=function(b,c){return e(b[a],c[a])});return n.call(f).sort(c)};h.constrain=function(){var a=o,b=e,c;var d=arguments,f={};d.length==2?(f[d[0]]=d[1],c=f):d.length==1&&(c=d[0]);e=a(b,c)};h.inverse=function(a){arguments.length==0&&i.isArr(this)&&(a=this);var c;c=l;var d=a;c=
r(c);var d=r(d),e;for(e in d)c[e]&&delete c[e];c=F(c);return b(c)};h.where=h.find=function(){return b(B.apply(this,arguments.length?[l].concat(n.call(arguments)):[l]))};h.view=function(a){var b={};h.sync(function(c){var d={},e;m(c,function(b){a in b&&(d[b[a]]=b)});for(e in d)e in b?b[e]!==d[e]&&(b[e]=d[e]):b[e]=d[e];for(e in b)e in d||delete b[e]});c();return b};h.missing=function(){return h.find(C.apply(this,n.call(arguments)))};h.findFirst=function(){var a=h.find.apply(this,n.call(arguments));return a.length?
a[0]:{}};h.select=function(a){var c=i.isArr(this)?this:h.find(),e={};arguments.length>1?a=n.call(arguments):i.isStr(a)&&(a=[a]);m(a,function(a,b){if(a=="*")e=w(c,q);else for(var d=0,f=c.length;d<f;d++)row=c[d],a in row&&(f>1?(e[d]||(e[d]=[]),e[d][b]=row[a]):e[d]=row[a])});return b(q(e))};h.insert=function(a){var d={},g=[],h=[];arguments.length>1?g=n.call(arguments):i.isArr(a)?g=a:g.push(a);e.unique&&m(l,function(a,b){d[a[e.unique]]=b});m(g,function(a){if(e.unique&&a[e.unique]in d)h.push(d[a[e.unique]]);
else{var b=l.length,c;if(k){var f={};m(k,function(a,b){f[a]=i.isFun(b)?b():b});a=o(f,a)}try{c=new (v(b)),o(c,a),l.push(c)}catch(g){a.constructor=v(b),l.push(a)}h.push(b)}});c();return b(f(h))};h.update=function(a,d){var e=i.isArr(this)?this:h.find(),f;arguments.length==2&&i.isStr(a)&&(f=a,a={},a[f]=d);i.isFun(a)?e.length&&m(e,a):m(a,function(a,b){i.isFun(b)?m(e,function(c){c[a]=b(c)}):m(e,function(c){c[a]=b})});c();return b(e)};h.remove=function(a){var d,e,f=[];d=i.isArr(this)?this:i.isArr(a)?a:arguments.length>
0?h.find(a):h.find();u.stain(d);d=l.length;for(var g=l.length-1;g>=0;g--)u.isStained(l[g])?f.push(l[g]):(d-(g+1)&&(e=g+1,l.splice(e,d-e)),d=g);e=g+1;d-e&&l.splice(e,d-e);c();return b(f)};if(arguments.length==1)if(i.isArr(a))h.insert(a);else if(i.isFun(a))h.insert(a());else if(i.isStr(a))return h.apply(this,arguments);else i.isObj(a)&&h.insert(a);else arguments.length>1&&h.insert(n.call(arguments));h.__raw__=l;return h}})();
